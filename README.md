# NetP_Mafia

## 1. 프로젝트 개요

Java TCP/IP 소켓과 Swing GUI를 활용한 5인 멀티플레이어 마피아 게임입니다. 서버가 직업을 배정하고 낮/밤 페이즈를 관리하며, 클라이언트는 GUI를 통해 채팅·투표·특수행동(마피아 살해 / 경찰 조사 / 의사 치료)을 수행합니다.

## 2. 실제 프로젝트 구조 (2025-11-13 기준)

```
NetP_Mafia/
├── src/
│   └── mafia_game/
│       ├── TcpApplication.java     # 설정 로드/공통 추상 클래스 (IP, PORT, timeStamp)
│       ├── AppServer.java          # 서버 소켓 생성 및 접속 스레드 생성 루프
│       ├── TcpServer.java          # 서버 진입 메뉴(콘솔) + AppServer 구동 엔트리
│       ├── TcpServerHandler.java   # 게임 상태/직업 배정/투표/밤 행동/채팅 처리
│       ├── MafiaGameClientMain.java# 클라이언트 GUI 실행 엔트리
│       └── MafiaGameGUI.java       # Swing 기반 클라이언트(채팅/투표/밤 행동/표/타이머)
├── config/
│   └── applicationcontext.ini      # 서버 설정(IP, PORT)
├── bin/                            # 컴파일 산출물(추가 예정 .gitignore 제외 권장)
└── README.md
```


## 3. 주요 구성 요소 역할

| 구성                | 설명                                                                                                             |
| ------------------- | ---------------------------------------------------------------------------------------------------------------- |
| TcpApplication      | 설정 파일(`applicationcontext.ini`) 로드 및 공통 유틸 제공                                                       |
| AppServer           | 지정된 PORT로 `ServerSocket` 열고 클라이언트 연결을 `TcpServerHandler` 스레드로 분기                             |
| TcpServer           | 콘솔 메뉴(입장/퇴장) 후 서버 초기화 및 시작 호출(학습용 래퍼)                                                    |
| TcpServerHandler    | 게임 전체 상태(static): 직업 배정, 낮/밤 페이즈, 투표/처형, 마피아/경찰/의사 밤 행동, 생존 관리, 승리 조건 판단  |
| MafiaGameClientMain | GUI 초기화 엔트리 (현재 클라이언트는 서버 설정을 하드코딩 localhost 사용)                                        |
| MafiaGameGUI        | 채팅, 타이머 수신(`TIMER_UPDATE`), 플레이어 목록(`PLAYER_LIST`), 게임 상태(`GAME_STATUS`) 표시 및 행동 명령 전송 |

## 4. 실행 방법

### 4.1 컴파일

```bash
javac -encoding UTF-8 -d bin -cp src src/mafia_game/*.java
```

### 4.2 서버 실행 (콘솔 메뉴 → 1 입력 후 시작)

```bash
java -cp bin mafia_game.TcpServer
```

### 4.3 클라이언트 실행 (각 사용자 PC/탭에서 반복)

```bash
java -cp bin mafia_game.MafiaGameClientMain
```

> 5명이 접속하면 자동으로 직업 배정 후 게임이 시작됩니다.

## 5. 게임 진행 흐름

1. 대기: 플레이어 이름 입력 후 5명 모이면 시작.
2. 직업 배정: [마피아 1 / 경찰 1 / 의사 1 / 시민 2] 무작위 배정 → 개별 귓속말(`/to`)로 역할 통지.
3. 낮(기본 30초): 토론 및 `/vote 대상` 명령을 통한 투표. 최다 득표자 처형 (동점 시 무효).
4. 밤(기본 15초):
   - 마피아: `/kill 대상`
   - 경찰: `/check 대상` → 마피아 여부 정보
   - 의사: `/heal 대상` → 마피아 타겟과 동일 시 생존 유지
5. 사망자 처리: 죽은 플레이어는 관찰자 모드(채팅만 가능, 투표/행동 불가).
6. 승리 조건:
   - 시민팀 승리: 모든 마피아 제거
   - 마피아팀 승리: 마피아 수 >= 생존 시민 수

## 6. 클라이언트 명령어 요약

| 명령                | 용도                         |
| ------------------- | ---------------------------- |
| 일반 채팅           | 그냥 문자열 입력             |
| `/to 닉네임 메시지` | 귓속말                       |
| `/vote 닉네임`      | 낮 투표                      |
| `/kill 닉네임`      | 밤 마피아 살해 (마피아 전용) |
| `/check 닉네임`     | 밤 조사 (경찰 전용)          |
| `/heal 닉네임`      | 밤 치료 (의사 전용)          |

## 7. 설정 파일 (`config/applicationcontext.ini`)

```ini
IP = localhost
PORT = 5592
```

서버는 `TcpApplication.init()` 단계에서 위 값을 로드합니다. 현재 클라이언트(`MafiaGameClientMain`)는 별도 설정 파싱 없이 `localhost:5592` 하드코딩이므로 추후 설정 동기화 개선이 필요합니다.

## 8. 현재 코드 상태 & 개선 필요 항목

### 구현됨

- 직업 배정(중복 없는 랜덤 순서)
- 낮/밤 페이즈 전환 및 중앙 타이머
- 투표 집계(동점 처리, 처형, 승리 조건 판단)
- 밤 행동(마피아 살해 / 경찰 조사 / 의사 치료) 및 치료 성공/실패 처리
- GUI: 플레이어 테이블/페이즈/타이머/역할 색상/행동 버튼 동적 활성화
- Whisper(`/to`) 및 일반 채팅 브로드캐스트

### 발견된 개선 포인트

| 항목                          | 설명                                             | 제안                                           |
| ----------------------------- | ------------------------------------------------ | ---------------------------------------------- |
| 하드코딩 클라이언트 서버 정보 | 클라이언트가 설정 파일을 읽지 않음               | 설정 파일 공유 또는 인자 전달 지원             |
| 스레드 관리                   | 클라이언트마다 new Thread 생성                   | ExecutorService 기반 풀 적용 검토              |
| 메시지 프로토콜 혼합          | 채팅/시스템/타이머/목록이 문자열 파싱 혼합       | 명확한 prefix + JSON 구조 표준화               |
| 미사용 메서드                 | `sendPlayerList()`, `sendGameStatus()` 호출 없음 | GUI 활용 위해 주기적 호출 로직 추가 또는 제거  |
| 중복 기능 `timeStamp()`       | `TcpServerHandler` 내부 별도 timeStamp 존재      | `TcpApplication.timeStamp()`만 사용하도록 통합 |
| 사용되지 않는 필드            | `TcpServerHandler.cAddr` 선언 후 미사용          | 제거하여 가독성 향상                           |
| 종료 처리 부족                | 서버 정상 종료 로직 없음                         | 종료 명령/자원 정리 추가                       |
| bin 폴더 추적                 | 컴파일 산출물 Git 관리 위험                      | `.gitignore` 추가 (`bin/`)                     |
| 예외 처리                     | 일부 InterruptedException, IOException 단순 무시 | 로깅/유저 안내 메시지 강화                     |

## 9. 향후 개발 계획 (로드맵)

- (단기) 클라이언트 설정 파싱 / 미사용 코드 정리 / 스레드풀 전환 실험
- (중기) 상태/이벤트 메시지 JSON 표준화, 밤 행동 UI 개선(선택 다이얼로그), 재접속 처리
- (중장기) 사운드 효과, 애니메이션(역할 배정/처형), 리플레이 로그 저장, 확장 직업(연구자 등)

## 10. 개발/운영 권장 사항

1. `.gitignore`에 `bin/` 및 OS 특수 파일 추가 (`bin/`, `*.log`, `.DS_Store` 등)
2. 서버/클라이언트 모두 SLF4J 같은 경량 로거 도입 고려
3. 메시지 스냅샷/리플레이를 위한 로그 버퍼 구조 초안 작성
4. 역할/행동 검증을 위한 JUnit 단위 테스트(직업 배정·승리 조건·투표 동점) 설계 권장

## 11. 기술 스택

- 언어: Java
- 네트워킹: TCP/IP Socket
- GUI: Swing
- 동시성: Thread (향후 ExecutorService 검토)

---

